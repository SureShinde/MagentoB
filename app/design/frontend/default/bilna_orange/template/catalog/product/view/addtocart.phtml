<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php $_escape_helper = Mage::helper('catalog/utils'); ?>
<?php $_product = $this->getProduct(); ?>
<?php
  $dateTime = Mage::getModel('core/date')->timestamp(time());
  $orderHour = date("H", $dateTime); 
  $orderDate = date('d F Y', $dateTime);
  $nextDay = date('d F Y', strtotime($orderDate . ' +1 day'));
  if ($_product->getExpressShipping()){
    if($orderHour<11){
      $img = $this->getSkinUrl('images/') . 'VIP-SHIPMENT-ICON-GREEN.png';
      echo "<div class='in-block container-express'>
                  <img src='".$img."' class='in-block margin-right-8'  style='width:35px;'>
                <div class='in-block'>
                  <p class='bold'>Tersedia Pengiriman Ekspress!
                    <span class='tool-box'>
                      <span class='question'>?</span> 
                      <span class='pops'>
                        <span class='arrow_box in-block stay-float'>
                          <span class='logo'>Selesaikan transaksi sebelum jam 11.00 WIB untuk terima produk hari ini. Pengiriman Express tersedia di <strong>JADETABEK</strong> khusus produk dengan icon <span class='in-tab'>
                          <img src='".$img."'  style='width:12px;'></span>. tidak dapat digabungkan dengan produk tanpa ikon tersebut &amp; COD</span>
                        </span>
                    </span>
                  </p>
                <p>Terima pesanan tanggal ".$orderDate."</p>
                </div>
            </div>";
    }else{
      $img = $this->getSkinUrl('images/') . 'VIP-SHIPMENT-ICON-GREEN.png';
      echo "<div class='in-block container-express'>
                  <img src='".$img."' class='in-block margin-right-8'  style='width:35px;'>
                <div class='in-block'>
                  <p class='bold'>Tersedia Pengiriman Ekspress!
                    <span class='tool-box'>
                      <span class='question'>?</span> 
                      <span class='pops'>
                        <span class='arrow_box in-block stay-float'>
                          <span class='logo'>Pengiriman Express tersedia di <strong>JADETABEK</strong> khusus produk dengan icon <span class='in-tab'>
                          <img src='".$img."'  style='width:12px;'></span>. tidak dapat digabungkan dengan produk tanpa ikon tersebut &amp; COD</span>
                        </span>
                    </span>
                  </p>
                <p>Terima pesanan tanggal ".$nextDay."</p>
                </div>
            </div>";
    }
  }
?>
<?php $buttonTitle = $this->__('Tambah ke troli'); ?>
<?php if($_product->isSaleable()): ?>
    <div class="add-to-cart">
        <?php if(!$_product->isGrouped()): ?>
        <label for="qty"><?php echo $this->__('Jumlah:') ?></label>
        <input type="text" name="qty" id="qty" maxlength="12" value="<?php echo $this->getProductDefaultQty() * 1 ?>" title="<?php echo $this->__('Jumlah') ?>" class="input-text qty" />
        <?php endif; ?>
        <button type="button" title="<?php echo $buttonTitle ?>" class="button btn-cart" onclick="productAddToCartForm.submit(this); ecommerceProductDetailAddToCart('<?php echo $_escape_helper->escapeQuote($_product->getName()); ?>','<?php echo $_product->getSku() ?>','<?php echo $_product->getPrice() ?>','<?php echo $_product->getProductUrl() ?>','<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(135); ?>');"><i class="fa fa-cart-plus"></i><span><?php echo $buttonTitle ?></span></button>
        <?php echo $this->getChildHtml('', true, true) ?>
        <a class="coll-quick addToCollectionLink coll-quick-top" onclick="showAddToCollectionDialog()" href="javascript:;"
                data-brand-name="<?php echo $brand; ?>"
                data-image="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(320, 320); ?>"
                data-product-name="<?php echo $this->stripTags($_product->getName(), null, true); ?>"
                data-price="<?php echo 'Rp. ' . number_format($_product->getPrice(), 0, '', '.'); ?>"
                data-merchant = "<?php echo ($merchant) ? 'dijual oleh ' . $merchant : ''; ?>"
                data-id="<?php echo $_product->getId(); ?>"
                ><i class="fa fa-heart"></i></a>
    </div>
<?php endif; ?>

<script type="text/javascript">
function ecommerceProductDetailAddToCart(name, sku, price, link, imageUrl) {
    if (jQuery("div.input-box select").val() != false) {
      // console.log("ECOMMERCE_ProductDetail_AddToCart_Ematics "+" "+name+" "+" "+sku+" "+price+" "+link+" "+imageUrl);
      dataLayer.push({
        'event': 'addToCart',
        'ecommerce': {
          'currencyCode': 'IDR',
          'add': {                                // 'add' actionFieldObject measures.
            'actionField': {'list': 'browsing'},
            'products': [{                        //  adding a product to a shopping cart.
              'name': name,
              'id': sku,
              'price': price,
              'quantity': jQuery("input.#qty").val(),
              'brandName': 'brand name',
              'imageUrl': imageUrl,
              'link': link
             }]
          }
        }
      });

      // ematics cart - prepare for logging
      products = [{
        'id': sku,
        'price': price,
        'quantity': jQuery("input.#qty").val(),
        'name': name,
        'brandName': 'brand name',
        'imageUrl': imageUrl,
        'link': link
      }];
      // ematics track items in cart to enable pre-abandonded cart overlays
      ematics("log", "product", "cart", products);
    } 
}
</script>