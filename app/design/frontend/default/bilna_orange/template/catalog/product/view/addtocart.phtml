<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php $_escape_helper = Mage::helper('catalog/utils'); ?>
<?php $_product = $this->getProduct(); ?>

<?php $buttonTitle = $this->__('Tambah ke troli'); ?>
<?php if($_product->isSaleable()): ?>
    <div class="add-to-cart">
        <?php if(!$_product->isGrouped()): ?>
        <label for="qty"><?php echo $this->__('Jumlah:') ?></label>
        <input type="text" name="qty" id="qty" maxlength="12" value="<?php echo $this->getProductDefaultQty() * 1 ?>" title="<?php echo $this->__('Jumlah') ?>" class="input-text qty" />
        <?php endif; ?>
        <button type="button" title="<?php echo $buttonTitle ?>" class="button btn-cart" onclick="productAddToCartForm.submit(this); ecommerceProductDetailAddToCart('<?php echo $_escape_helper->escapeQuote($_product->getName()); ?>','<?php echo $_product->getSku() ?>','<?php echo $_product->getPrice() ?>','<?php echo $_product->getProductUrl() ?>','<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(135); ?>');"><i class="fa fa-cart-plus"></i><span><?php echo $buttonTitle ?></span></button>
        <?php echo $this->getChildHtml('', true, true) ?>
    </div>
<?php endif; ?>

<script type="text/javascript">
function ecommerceProductDetailAddToCart(name, sku, price, link, imageUrl) {
    if (jQuery("div.input-box select").val() != false) {
      // console.log("ECOMMERCE_ProductDetail_AddToCart_Ematics "+" "+name+" "+" "+sku+" "+price+" "+link+" "+imageUrl);
      dataLayer.push({
        'event': 'addToCart',
        'ecommerce': {
          'currencyCode': 'IDR',
          'add': {                                // 'add' actionFieldObject measures.
            'actionField': {'list': 'browsing'},
            'products': [{                        //  adding a product to a shopping cart.
              'name': name,
              'id': sku,
              'price': price,
              'quantity': jQuery("input.#qty").val(),
              'brandName': 'brand name',
              'imageUrl': imageUrl,
              'link': link
             }]
          }
        }
      });

      // ematics cart
      ematics("log", "product", "cart", 
            [{
              'name': name,
              'id': sku,
              'price': price,
              'quantity': jQuery("input.#qty").val(),
              'brandName': 'brand name',
              'imageUrl': imageUrl,
              'link': link
            }]
        );
    } 
}
</script>