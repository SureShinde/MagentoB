<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<div class="product-view">
    <div class="product-essential">
    <form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
        <?php echo $this->getBlockHtml('formkey') ?>
        <div class="no-display">
            <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
            <input type="hidden" name="related_product" id="related-products-field" value="" />
        </div>

        <div class="product-shop">
			<div class="product-shop-left">
				<div class="product-name">
					<h1><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h1>
				</div>
				
				<?php
					$myproduct = Mage::getModel('catalog/product')->load($_product->getId());
					$product_brands = $myproduct->getAttributeText('brands');
					if($product_brands) :
				?>				
				<div class="by-brand">
					<?php echo $this->getChildHtml('brand') ?>
				</div>				
				<?php endif; ?>

				<?php echo $this->getChildHtml('product_type_data') ?>
				<?php echo $this->getReviewsSummaryHtml($_product, false, true)?>
				
				<?php $stock_left = Mage::getModel('cataloginventory/stock_item')->loadByProduct($_product)->getQty() ?>
				<div class="stock-left">
					<p><?php echo $this->__('Only %d left in stock', $stock_left) ?></p>
				</div>
				<?php
					$ship_from = $_helper->productAttribute($_product, $_product->getShipFrom(), 'ship_from');
					$sold_by   = $_helper->productAttribute($_product, $_product->getSoldBy(), 'sold_by');
				?>
				<div class="shipsfrom-soldby">
					<p><?php echo $this->__('Ships from <span>%s</span> and sold by <span>%s</span>', ( $ship_from ? $ship_from : '-'), ( $sold_by ? $sold_by : '-')) ?></p>
				</div>
				
				<?php echo $this->getTierPriceHtml() ?>
				<?php echo $this->getChildHtml('alert_urls') ?>
				<?php echo $this->getChildHtml('extrahint') ?>

				<?php if ($_product->getShortDescription()):?>
					<div class="short-description">
						<div class="std"><?php echo $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description') ?></div>
					</div>
				<?php endif;?>
				
				<?php if ($_product->isSaleable() && $this->hasOptions()):?>
					<div class="product-container1">
					<?php echo $this->getChildChildHtml('container1', '', true, true) ?>
					</div>
				<?php endif;?>
				<?php if ($_product->isSaleable() && $this->hasOptions()):?>
					<?php echo $this->getChildChildHtml('container2', '', true, true) ?>
				<?php endif;?>
			</div>			
			<script>
				// jQuery(document).ready(function(){
					// if($j('select').length > 0) {
						// $j('select').each(function(){
							// $j(this).wrap('<div class="select" />');
							// $j(this).parent().prepend('<span>' + $j(this).children("option").filter(":selected").text() + '</span>');
							// $j(this).parent().css('width',$j(this).width());
							// if($j(this).hasClass("required-entry")) 
								// $j(this).parent().css('width',$j(this).width());
						// });
						// $j('select').change(function(){
							// $j(this).prev().text($j(this).children("option").filter(":selected").text());
						// });
					// }
				// });
			</script>
			
			<div class="product-shop-right">
				<?php if (!$this->hasOptions()):?>
					<div class="add-to-box">
						<?php if($_product->isSaleable()): ?>
							<?php echo $this->getChildHtml('addtocart') ?>
						<?php endif; ?>
					</div>
					<?php echo $this->getChildHtml('extra_buttons') ?>
				<?php elseif (!$_product->isSaleable()): ?>
					<div class="add-to-box">
						<?php echo $this->getChildHtml('addto') ?>
					</div>
				<?php elseif($this->hasOptions()): ?>
					<?php if($_product->isSaleable()): ?>
						<?php echo $this->getChildHtml('addtocart') ?>
					<?php endif; ?>
				<?php endif; ?>
				
				<div class="one-click-checkout">
					<a href="#"><?php echo $this->__('One Click Checkout') ?></a>
				</div>				
				<div class="buy-later">				
					<?php echo $this->getChildHtml('addto') ?>
				</div>				
				
				<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('buying_choice')->toHtml() ?>

				<?php echo $this->getChildHtml('other');?>
				
				<div class="share-button">
					<span class='st_twitter_hcount' displayText='Tweet'></span>
					<span class='st_fblike_hcount' displayText='Facebook Like'></span>
					<span class='st_plusone_hcount' displayText='Google +1'></span>
					<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
					<script type="text/javascript">stLight.options({publisher: "b9878051-cbe0-48e6-a245-b0a08e0f964d", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>
				</div>
				
				<?php if ($this->canEmailToFriend()): ?>
					<p class="email-friend"><a href="<?php echo $this->helper('catalog/product')->getEmailToFriendUrl($_product) ?>"><?php echo $this->__('Email to a Friend') ?></a></p>
				<?php endif; ?>
			</div>
        </div>

        <div class="product-img-box">
            <?php echo $this->getChildHtml('media') ?>
        </div>

        <div class="clearer"></div>
		<div class="product-tab-wrapper">
			<div id="tab-container" class="tab-container">
				<ul class="etabs">
					<?php foreach ($this->getChildGroup('detailed_info', 'getChildHtml') as $alias => $html):?>
						<li class="tab"><a href="#<?php echo "tabs-{$alias}"?>">
							<?php if ($alias == 'description'):?>
				            <?php echo $this->__('Description'); ?>
				            <?php elseif ($alias == 'additional') :?>
				            <?php echo $this->__('Additional Info'); ?>
				            <?php endif;?>
						</a></li>
				<?php endforeach;?>
				<li class="tab"><a href="#tabs-features">Features</a></li>
				<li class="tab"><a href="#tabs-size-chart">Size Chart</a></li>
				</ul>	
				<div class="panel-container">
					<?php foreach ($this->getChildGroup('detailed_info', 'getChildHtml') as $alias => $html):?>
						<div id="<?php echo "tabs-{$alias}"?>">
						    <?php echo $html; ?>
						</div>
					<?php endforeach;?>
					<div id="tabs-features">
					<p><strong>Lorem ipsum dolor sit amet</strong>, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					</div>
					<div id="tabs-size-chart">
					<p><strong>Lorem ipsum dolor sit amet</strong>, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					</div>
				</div>
			</div>
			<script type="text/javascript">
			// <![CDATA[
				$j(document).ready( function() {
					$j('#tab-container').easytabs();
				});
			// ]]>
			</script>
		</div>
		
		<div class="product-tab-mobile-wrapper">
			<div id="tab-container" class="tab-container">
				<?php $idx_tab = 0;?>
				<?php foreach ($this->getChildGroup('detailed_info', 'getChildHtml') as $alias => $html):?>
					<h3 class="toggle-tab" id="index<?php echo $idx_tab;?>">
					<?php if ($alias == 'description'):?>
					<?php echo $this->__('Description'); ?>
					<?php elseif ($alias == 'additional') :?>
					<?php echo $this->__('Additional Info'); ?>
					<?php endif;?>
					</h3>
					<div class="content-tab" id="content<?php echo $idx_tab;?>">
						<?php echo $html; ?>
					</div>
					<?php $idx_tab = $idx_tab + 1;?>
				<?php endforeach;?>
				<h3 class="toggle-tab" id="index<?php echo $idx_tab + 1;?>">Features</h3>
				<div class="content-tab" id="content<?php echo $idx_tab + 1;?>">
					<p><strong>Lorem ipsum dolor sit amet</strong>, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
				<h3 class="toggle-tab" id="index<?php echo $idx_tab + 2;?>">Size Chart</h3>
				<div class="content-tab" id="content<?php echo $idx_tab + 2;?>">
					<p><strong>Lorem ipsum dolor sit amet</strong>, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
			</div>			
			<script type="text/javascript">
			// <![CDATA[
				$j(document).ready( function() {					
					$j('.toggle-tab').click(function(){
						$j(this).next().slideToggle('slow');
					});
				});
			// ]]>
			</script>
		</div>
    </form>
    <script type="text/javascript">
    //<![CDATA[
        var productAddToCartForm = new VarienForm('product_addtocart_form');
        productAddToCartForm.submit = function(button, url) {
            if (this.validator.validate()) {
                var form = this.form;
                var oldUrl = form.action;

                if (url) {
                   form.action = url;
                }
                var e = null;
                try {
                    this.form.submit();
                } catch (e) {
                }
                this.form.action = oldUrl;
                if (e) {
                    throw e;
                }

                if (button && button != 'undefined') {
                    button.disabled = true;
                }
            }
        }.bind(productAddToCartForm);

        productAddToCartForm.submitLight = function(button, url){
            if(this.validator) {
                var nv = Validation.methods;
                delete Validation.methods['required-entry'];
                delete Validation.methods['validate-one-required'];
                delete Validation.methods['validate-one-required-by-name'];
                // Remove custom datetime validators
                for (var methodName in Validation.methods) {
                    if (methodName.match(/^validate-datetime-.*/i)) {
                        delete Validation.methods[methodName];
                    }
                }

                if (this.validator.validate()) {
                    if (url) {
                        this.form.action = url;
                    }
                    this.form.submit();
                }
                Object.extend(Validation.methods, nv);
            }
        }.bind(productAddToCartForm);
    //]]>
    </script>
    </div>
	<div class="related-product">
		<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('related_product')->toHtml() ?>
	</div>
	<script type="text/javascript">
	// <![CDATA[
		$j(document).ready( function() {
			$j('#customer-reviews h2').click(function(){
				$j('#customer-reviews ol').slideToggle('slow');
				$j('.review-show-all').slideToggle();
			});
		});
	// ]]>
	</script>
</div>
