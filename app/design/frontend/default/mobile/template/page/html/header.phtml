<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_mobile
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
?>

<script type="text/javascript">
$j(document).ready(function() {
    
        $j("img.lazy, .wrap-banner img:not(.image-slider), .warp-banner img").after('<div class="loader"><img class="loader-img" src="<?php echo Mage::getBaseUrl(); ?>skin/frontend/base/default/images/loading.gif"></div>');
});
</script>

<!-- ematic cart payload -->
<?php $_items = Mage::helper('checkout/cart')->getQuote()->getAllItems(); ?>
<?php $itemQty = Mage::helper('checkout/cart')->getItemsCount(); ?>
<?php foreach($_items as $_item): ?>
    <?php $parentId = $_item->getParentItemId(); ?>
    <?php if(empty($parentId)): ?>
        <?php echo '<span id="ematiccart" class="hidden">' . $_item->getProduct()->getName() . $_item->getTypeInstance() . '|' . $_item->getProduct()->getSku() . '|' . $_item->getProduct()->getPrice() . '|' . Mage::helper('core')->currency($_item->getProduct()->getPrice(), true, false) . '|' . $_item->getQty() . '|' . $_item->getProduct()->getImageUrl() . '|' . $_item->getProduct()->getProductUrl() . '</span>' ?>
        <?php if($itrNumberItemsDisplayed < $_numberItemsDisplayed): ?>
            <?php echo $this->getItemHtml($_item); ?>
        <?php endif ?>
        <?php $itrNumberItemsDisplayed++; ?>
    <?php endif ?>
<?php endforeach; ?>
<!-- END ematic cart payload -->

<div class="header-container">
    <?php echo $this->getLayout()->createBlock('page/html')->setTemplate('page/html/back-top.phtml')->toHtml(); ?>
    
    <div class="header">
        <div class="wrap-header-top-mobile">
            <a href="#" class="nav-mobile-trigger">
                <span class="notclick fa fa-bars"></span>
                <span class="clicked fa fa-times"></span>
            </a>
            <a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>" class="logo"><strong><?php echo $this->getLogoAlt() ?></strong>
                <img src="<?php echo $this->getLogoSrc() ?>" alt="<?php echo $this->getLogoAlt() ?>" />
            </a>

            <div class="quick-access">
                <a href="#!" class="search-menu" ><i class="fa fa-search"></i></a>
                <?php require_once 'app/Mage.php';


                $sessionCustomer = Mage::getSingleton("customer/session");

                if($sessionCustomer->isLoggedIn()) {?>
                    <a href="#" class="link-myaccount-mobile loggedin"><i class="fa fa-user"></i></a>
                <?php } else {?>
                    <a href="<?php echo Mage::getBaseUrl(); ?>customer/account/login/" class="link-myaccount-mobile"><?php echo $this->__('Login') ?></a>
                <?php } ?>
                
                    <?php echo $this->getChildHtml('topLinks') ?>

                <?php $_totalItem = $this->helper('checkout/cart')->getSummaryCount();  //get total items in cart ?>

                <?php if ($_totalItem == 0): ?>
                <a href="<?php echo Mage::getBaseUrl(); ?>checkout/cart" class="link-minicart" id="link-minicart"><i class="fa fa-shopping-cart"></i><span class="qty"><?php echo $this->__('0') ?></span></a>
                <?php else: ?>
                <a href="<?php echo Mage::getBaseUrl(); ?>checkout/cart" class="link-minicart" id="link-minicart"><i class="fa fa-shopping-cart"></i><span class="qty"><?php echo $this->__($_totalItem) ?></span></a>
                <?php endif; ?>

                <p class="welcome-msg"><?php echo $this->getChildHtml('welcome') ?> <?php echo $this->getAdditionalHtml() ?></p>

                <div class="clear"></div>
            </div>
            <div class="search-container-new-mobile">
                <?php echo $this->getChildHtml('topSearch'); ?>
            </div>
        </div>
        
        <?php echo $this->getChildHtml('topContainer'); ?>
        <div class="second_button_left_menu">
            <div class="title_belanja">
                <p><?php echo $this->__('BELANJA') ?> </p>
            </div>
            <div class="direktori_belanja">
                <p><i class="fa fa-th-large"></i><?php echo $this->__('DIREKTORI BELANJA') ?> </p>
            </div>
            <?php //echo $this->getLayout()->createBlock('staticarea/block')->setId('banner-corner')->toHtml();?>
        </div>
    </div>
</div>

<div class="bg-dark-megamenu"></div>
<?php 
 $customer = Mage::getSingleton('customer/session')->getCustomer();
 if(isset($customer) && !empty($customer)){
 	$email = $customer->getEmail();// for email address
 }else{
 	$email = "";
 }

// ematic user email for API calling
echo '<span id="ematicuseremail" class="hidden">'.$email.'</span>';
?>
<script type="text/javascript">
jQuery(document).ready(function () {    
	//dataLayer.push( {'sitetype': 'd'} );
	//dataLayer.push( {'emailaddress': '<?php echo $email; ?>'} );
});
</script>

<!-- ecommerce Google Analytics & Ematic -->
<script type="text/javascript">
function ecommerceCheckout0_buttonclicked() {
    var temp_container = {
        'event': 'checkout',
        'ecommerce': {
          'checkout': {
            'actionField': {
                'step' : 1,
                'list' : 'browsing'
            },
            'products': []
         }
       }
    }

    // ematics cart - retrieve items from cart
    var temp_cart = [];
    var temp_item = "";
    var index_removeditem = "";
    var temp_cartQty = jQuery("span#ematiccart").length;
    for (var itr=0; itr < temp_cartQty; itr++) {
        temp_item = jQuery("span#ematiccart").eq(itr).text();
        temp_cart[itr] = temp_item.split("|");
    }

    // ematics cart - prepare for logging
    if (temp_cartQty > 0) {         // at least 1 item in cart
        products = [
        <?php for($i=0; $i<$itemQty; $i++) {
            echo "{'name' : temp_cart[".$i."][0],";
            echo "'id' : temp_cart[".$i."][1],";
            echo "'price' : temp_cart[".$i."][3],";
            echo "'quantity' : temp_cart[".$i."][4],";
            echo "'brandName' : 'brand name',";
            echo "'imageUrl' : temp_cart[".$i."][5],";
            echo "'link' : temp_cart[".$i."][6]}";if($i != $itemQty-1) {echo ",";}
        } 
        ?>
        ];

        // ematics track checkout
        ematics("log", "product", "checkout", products);

        // universal analytics
        temp_container.ecommerce.checkout.products.push(
            <?php for($i=0; $i<$itemQty; $i++) {
                echo "{'name' : temp_cart[".$i."][0],";
                echo "'sku' : temp_cart[".$i."][1],";
                echo "'price' : temp_cart[".$i."][2],";
                echo "'quantity' : temp_cart[".$i."][4],";
                echo "'brandName' : 'brand name',";
                echo "'imageUrl' : temp_cart[".$i."][5],";
                echo "'link' : temp_cart[".$i."][6]}";if($i != $itemQty-1) {echo ",";}
            } 
            ?>
            );
        dataLayer.push(temp_container);
    }
}

function ecommerceRemoveCart(name, sku, price, quantity, imageUrl, link) {
    dataLayer.push({
      'event': 'removeFromCart',
      'ecommerce': {
        'remove': {                               // 'remove' actionFieldObject measures.
          'products': [{                          //  removing a product to a shopping cart.
            'name': name,
            'id': sku,
            'price': price,
            'quantity': quantity,
            'brandName': 'brand name',
            'imageUrl': imageUrl,
            'link': link
          }]
        }
      }
    });

    // ematics cart - retrieve items from cart
    var temp_cart = [];
    var temp_item = "";
    var index_removeditem = "";
    for (var itr=0; itr < <?php echo $itemQty ?>; itr++) {
        temp_item = jQuery("span#ematiccart").eq(itr).text();
        if (temp_item.indexOf(sku) == -1) {     // item that not removed
            temp_cart[itr] = temp_item.split("|");
        }
        else {      // removed item
            index_removeditem = itr;
        }
    }

    // trim empty array because removed item
    temp_cart = temp_cart.filter(function(v){return v!==''});

    // ematics cart - prepare for logging
    if (temp_cartQty > 0) {         // at least 1 item in cart
        products = [
        <?php for($i=0; $i<$itemQty-1; $i++) {
            echo "{'name' : temp_cart[".$i."][0],";
            echo "'id' : temp_cart[".$i."][1],";
            echo "'price' : temp_cart[".$i."][3],";
            echo "'quantity' : temp_cart[".$i."][4],";
            echo "'brandName' : 'brand name',";
            echo "'imageUrl' : temp_cart[".$i."][5],";
            echo "'link' : temp_cart[".$i."][6]}";if($i != $itemQty-2) {echo ",";}
        } 
        ?>
        ];

        // ematics track items in cart to enable pre-abandonded cart overlays
        ematics("log", "product", "cart", products);
    }
}
</script>
<!-- END ecommerce Google Analytics & Ematic -->