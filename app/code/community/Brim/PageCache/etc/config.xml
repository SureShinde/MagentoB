<?xml version="1.0"?>
<!--
/**
 * Brim LLC Commercial Extension
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Brim LLC Commercial Extension License
 * that is bundled with this package in the file Brim-LLC-Magento-License.pdf.
 * It is also available through the world-wide-web at this URL:
 * http://ecommerce.brimllc.com/license
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to support@brimllc.com so we can send you a copy immediately.
 *
 * @category   Brim
 * @package    Brim_PageCache
 * @copyright  Copyright (c) 2011-2012 Brim LLC
 * @license    http://ecommerce.brimllc.com/license
 */
-->
<config>
	<modules>
		<Brim_PageCache>
			<version>3.0.2</version>
		</Brim_PageCache>
	</modules>
	<global>
		<models>
			<brim_pagecache>
				<class>Brim_PageCache_Model</class>
                <resourceModel>brim_pagecache_resource</resourceModel>
			</brim_pagecache>
            <brim_pagecache_resource>
                <class>Mage_Core_Model_Mysql4_Resource</class>
                <entities>
                    <cache>
                        <table>brim_pagecache_cache</table>
                    </cache>
                    <cache_tag>
                        <table>brim_pagecache_cache_tag</table>
                    </cache_tag>
                </entities>
            </brim_pagecache_resource>
		</models>
        <resources>
            <brim_pagecache_setup>
                <setup>
                    <module>Brim_PageCache</module>
                </setup>
            </brim_pagecache_setup>
        </resources>
		<blocks>
			<brim_pagecache>
				<class>Brim_PageCache_Block</class>
			</brim_pagecache>
		</blocks>
		<helpers>
			<brim_pagecache>
				<class>Brim_PageCache_Helper</class>
			</brim_pagecache>
		</helpers>
        <cache>
            <types>
                <brim_pagecache>
                    <label>Full Page Cache</label>
                    <description>Full Page Cache</description>
                    <tags>BRIM_FPC</tags>
                </brim_pagecache>
            </types>
            <expires>
                <brim_pagecache>
                    <label>Full Page Cache</label>
                </brim_pagecache>
            </expires>
        </cache>
		<events>
            <adminhtml_cache_refresh_type>
				<observers>
					<brim_pagecache>
						<type>singleton</type>
						<class>brim_pagecache/adminhtml_observer</class>
						<method>handleTypeRefresh</method>
					</brim_pagecache>
				</observers>
            </adminhtml_cache_refresh_type>
            <adminhtml_cache_flush_all>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>cleanPageCache</method>
                    </brim_pagecache>
                </observers>
            </adminhtml_cache_flush_all>
            <adminhtml_cache_flush_system>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>cleanPageCache</method>
                    </brim_pagecache>
                </observers>
            </adminhtml_cache_flush_system>
            <controller_action_postdispatch_adminhtml_cache_flushSystem>
				<observers>
					<brim_pagecache>
						<type>singleton</type>
						<class>brim_pagecache/adminhtml_observer</class>
						<method>cleanPageCache</method>
					</brim_pagecache>
				</observers>
            </controller_action_postdispatch_adminhtml_cache_flushSystem>
            <controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>invalidateCache</method>
                    </brim_pagecache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
            <controller_action_postdispatch_adminhtml_catalog_product_massStatus>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>invalidateCache</method>
                    </brim_pagecache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_massStatus>
            <admin_system_config_changed_section_brim_pagecache>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>configChanged</method>
                    </brim_pagecache>
                </observers>
            </admin_system_config_changed_section_brim_pagecache>
            <catalog_product_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductCache</method>
                    </brim_pagecache>
                </observers>
            </catalog_product_save_after>
            <catalog_category_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanCategoryCache</method>
                    </brim_pagecache>
                </observers>
            </catalog_category_save_after>
            <cms_page_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanCMSPageCache</method>
                    </brim_pagecache>
                </observers>
            </cms_page_save_after>
            <cataloginventory_stock_item_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductCacheOnStockChange</method>
                    </brim_pagecache>
                </observers>
            </cataloginventory_stock_item_save_after>
            <catalogrule_rule_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductsInCatalogPriceRule</method>
                    </brim_pagecache>
                </observers>
            </catalogrule_rule_save_after>
		</events>
	</global>
    <frontend>
        <routers>
            <brim_pagecache>
                <use>standard</use>
                <args>
                    <module>Brim_PageCache</module>
                    <frontName>brim_pagecache</frontName>
                </args>
            </brim_pagecache>
        </routers>
        <layout>
            <updates>
                <brim_pagecache>
                    <file>brim-page-cache.xml</file>
                </brim_pagecache>
            </updates>
        </layout>
        <events>
            <controller_action_predispatch>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>checkAndServeCachedPage</method>
                    </brim_pagecache>
                </observers>
            </controller_action_predispatch>
            <controller_action_layout_generate_xml_before>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>addLayoutUpdates</method>
                    </brim_pagecache>
                </observers>
            </controller_action_layout_generate_xml_before>
            <controller_front_send_response_before>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cachePage</method>
                    </brim_pagecache>
                </observers>
            </controller_front_send_response_before>
            <!--  controller_front_send_response_after event is for for 1.4 compat -->
            <controller_front_send_response_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cachePage</method>
                    </brim_pagecache>
                </observers>
            </controller_front_send_response_after>
            <core_block_abstract_to_html_before>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>prepareDynamicBlocks</method>
                    </brim_pagecache>
                </observers>
            </core_block_abstract_to_html_before>
            <core_block_abstract_to_html_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>markDynamicBlocks</method>
                    </brim_pagecache>
                    <brim_pagecache_registertags>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>registerTags</method>
                    </brim_pagecache_registertags>
                </observers>
            </core_block_abstract_to_html_after>
            <catalog_block_product_list_collection>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>registerProductTags</method>
                    </brim_pagecache>
                </observers>
            </catalog_block_product_list_collection>
            <sales_quote_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnQuoteSave</method>
                    </brim_pagecache>
                </observers>
            </sales_quote_save_after>
            <customer_login>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnCustomerLogin</method>
                    </brim_pagecache>
                </observers>
            </customer_login>
            <customer_logout>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnCustomerLogout</method>
                    </brim_pagecache>
                </observers>
            </customer_logout>
            <wishlist_wishlist_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnWishlistSave</method>
                    </brim_pagecache>
                </observers>
            </wishlist_wishlist_save_after>
            <catalog_product_compare_add_product>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnCompareChange</method>
                    </brim_pagecache>
                </observers>
            </catalog_product_compare_add_product>
            <catalog_product_compare_remove_product>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnCompareChange</method>
                    </brim_pagecache>
                </observers>
            </catalog_product_compare_remove_product>
            <catalog_product_compare_item_collection_clear>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>updateBlockKeysOnCompareChange</method>
                    </brim_pagecache>
                </observers>
            </catalog_product_compare_item_collection_clear>
        </events>
        <brim_pagecache>
            <actions>
                <catalog_product_view>
                    <recently_viewed>
                        <class>Brim_PageCache_Model_Container_Recentlyviewed</class>
                        <method>addProductViewed</method>
                    </recently_viewed>
                </catalog_product_view>
            </actions>
        </brim_pagecache>
    </frontend>
    <crontab>
        <jobs>
            <brim_pagecache_cleanoldcache>
                <schedule>
                    <cron_expr>*/15 * * * *</cron_expr>
                </schedule>
                <run>
                    <model>brim_pagecache/cron::cleanOldCache</model>
                </run>
            </brim_pagecache_cleanoldcache>
        </jobs>
    </crontab>
    <default>
        <brim_pagecache>
            <settings>
                <enabled>1</enabled>
                <cache_block_updates>0</cache_block_updates>
                <enable_minify_html>0</enable_minify_html>
                <expires>7200</expires>
                <invalidate_clean>0</invalidate_clean>
                <debug>0</debug>
                <debug_response>0</debug_response>
            </settings>
            <conditions>
                <ignore_params>gclid</ignore_params>
            </conditions>
            <storage>
                <system_cache>1</system_cache>
                <override_system_file>0</override_system_file>
            </storage>
        </brim_pagecache>
    </default>
</config>
